System.register(["./views"],function(o){"use strict";var e,i,t;return{setters:[function(o){e=o.HomeView,i=o.ChatRoomView}],execute:function(){t=function(o){var t=function n(){this.routes={"":"home",":id":"chatroom"},$traceurRuntime.superConstructor(n).call(this),$(window).unload(this.leaveRoom)};return $traceurRuntime.createClass(t,{home:function(){this.loadView(new e({collection:window.chatRooms}))},chatroom:function(o){var e=window.chatRooms.find({id:o});e?(window.socket.removeListener("message"),this.loadView(new i({model:e})),this.joinRoom(o)):this.navigate("/",{trigger:!0})},loadView:function(o){window.room&&this.leaveRoom(),this.view&&(this.view.close?this.view.close():this.view.remove()),this.view=o,$("#app").html(this.view.$el)},joinRoom:function(o){window.room=o,window.chatRooms.find({id:o}).addUser(window.username),window.socket.emit("joinRoom",{room:o,username:window.username})},leaveRoom:function(){window.room&&(window.chatRooms.find({id:window.room}).removeUser(window.username),window.room=null,window.socket.emit("leaveRoom"))}},{},o)}(Backbone.Router),o("default",t)}}});